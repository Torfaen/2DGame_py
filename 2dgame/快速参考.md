# 快速参考手册

## 🎮 游戏操作

| 玩家 | 移动 | 放置炸弹 |
|------|------|----------|
| 玩家1 | 方向键 ↑↓←→ | 右Shift |
| 玩家2 | WASD | 左Shift |
| 调试模式 | 数字键 `1` | - |

---

## 📁 重要文件路径

### 代码文件
- `src/game_manager.py` - 游戏主程序（推荐使用）
- `src/main.py` - 旧版游戏主程序
- `src/player.py` - 玩家类
- `src/map.py` - 地图类
- `src/bomb.py` - 炸弹类
- `src/item.py` - 道具类

### 配置文件
- `config/config.yaml` - 主配置（窗口、游戏模式）
- `config/config_player.yaml` - 玩家配置（按键、出生点）
- `config/config_character.yaml` - 角色属性（速度、炸弹数）
- `config/config_tile.yaml` - 地图物块配置
- `config/config_items.yaml` - 道具配置

### 地图数据
- `map/floor_map.json` - 地板层
- `map/barrier_map.json` - 障碍物层
- `map/collision_map.json` - 碰撞层

---

## 🔧 快速修改指南

### 修改玩家速度
**文件**: `config/config_character.yaml`
```yaml
characters:
  manbo:
    speed: 2        # 修改这里
    speed_max: 5    # 最大速度
```

### 修改窗口大小
**文件**: `config/config.yaml`
```yaml
windows:
  window:
    width: 800      # 修改宽度
    height: 600     # 修改高度
```

### 修改炸弹爆炸时间
**文件**: `src/bomb.py`
```python
# 找到这一行（约第100行）
if self.timer >= FPS*3.5:  # 3.5秒，改为其他值如 2.0
```

### 修改道具掉落概率
**文件**: `src/game_manager.py`
```python
# 找到这一行（约第336行）
drop_rate = 0.3  # 30%，改为0.5表示50%
```

### 修改玩家按键
**文件**: `config/config_player.yaml`
```yaml
player1:
  controls:
    up: "K_UP"      # 改为 "K_w" 使用W键
    down: "K_DOWN"
    left: "K_LEFT"
    right: "K_RIGHT"
    shift: "K_RSHIFT"
```

---

## 📊 游戏参数说明

### 玩家属性
- `speed`: 移动速度（像素/帧）
- `speed_max`: 最大移动速度
- `bombs_count`: 最多同时放置的炸弹数
- `bombs_max`: 炸弹数量上限
- `bomb_power`: 炸弹爆炸威力（格子数）
- `bomb_power_max`: 炸弹威力上限

### 地图坐标系统
- **格子大小**: 32x32像素
- **坐标原点**: 左上角 (0, 0)
- **X轴**: 向右为正
- **Y轴**: 向下为正

### 碰撞层数值
- `0`: 可通行
- `1`: 可摧毁障碍物
- `2`: 不可摧毁障碍物

---

## 🐛 常见错误及解决方法

### 错误1: ModuleNotFoundError: No module named 'pygame'
**解决**: 安装Pygame
```bash
pip install pygame pyyaml
```

### 错误2: 找不到配置文件
**解决**: 确保在`src/`目录下运行
```bash
cd 2dgame/src
python game_manager.py
```

### 错误3: 贴图加载失败
**解决**: 检查`config/config_tile.yaml`中的路径是否正确

### 错误4: 地图加载失败
**解决**: 检查`map/`目录下的JSON文件是否存在

---

## 💡 调试技巧

### 1. 使用print()输出调试信息
```python
print(f"玩家位置: ({player.rect.x}, {player.rect.y})")
print(f"炸弹数量: {len(player.bombs_active)}")
```

### 2. 开启调试模式
按数字键`1`开启，会显示：
- 绿色框：玩家碰撞框
- 蓝色框：地图碰撞框
- 坐标信息

### 3. 修改帧率观察慢动作
```python
# 在game_manager.py中
self.clock.tick(30)  # 改为30 FPS，慢动作观察
```

---

## 📝 代码关键点速查

### 游戏主循环
```python
while running:
    clock.tick(60)          # 60 FPS
    handle_events()         # 处理输入
    update()                # 更新状态
    render()                # 绘制画面
    display.update()        # 更新显示
```

### 玩家移动
```python
dx, dy = player.handle_input()  # 获取输入
player.move(dx, dy, collision_rects)  # 移动并检测碰撞
```

### 放置炸弹
```python
if keys[player.controls["shift"]] and player.bomb_cooldown <= 0:
    create_bomb(player, bombs_group)
```

### 爆炸检测
```python
if bomb.timer >= FPS * 3.5:
    bomb.exploded = True
    trigger_explosion(bomb)
```

### 碰撞检测
```python
if rect1.colliderect(rect2):
    # 发生碰撞
    handle_collision()
```

---

## 🎯 老师可能问的问题（快速回答）

### Q: 游戏是如何运行的？
**A**: 游戏通过主循环运行，每帧处理输入、更新状态、绘制画面，循环60次/秒。

### Q: 碰撞检测怎么实现？
**A**: 使用Pygame的`rect.colliderect()`方法检测两个矩形是否重叠。

### Q: 炸弹爆炸范围如何计算？
**A**: 炸弹向上下左右四个方向扩散，每个方向扩散`power`格，遇到障碍物停止。

### Q: 为什么使用配置文件？
**A**: 方便修改游戏参数，不需要改代码，便于维护和扩展。

### Q: 绘制顺序如何实现？
**A**: 按对象的底部Y坐标排序，先绘制Y小的（上方），后绘制Y大的（下方），实现遮挡关系。

### Q: 如何防止玩家快速连续放置炸弹？
**A**: 使用冷却时间（cooldown），放置炸弹后需要等待一段时间才能再放。

### Q: 道具如何生成？
**A**: 炸毁障碍物时，有30%概率随机生成一个道具，类型从配置文件中读取。

### Q: 连锁爆炸如何实现？
**A**: 爆炸时检查其他炸弹是否在爆炸范围内，如果在范围内，立即触发该炸弹爆炸。

---

## 🔗 相关文档

- `项目入门指南.md` - 详细的项目介绍和入门教程
- `代码详解.md` - 深入的代码解释和设计说明

---

**提示**: 如果遇到问题，先查看`项目入门指南.md`和`代码详解.md`获取更详细的说明。

